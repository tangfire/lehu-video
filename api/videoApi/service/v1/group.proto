 syntax = "proto3";

package api.videoApi.service.v1;

option go_package = "lehu-video/api/videoApi/service/v1;v1";
option java_multiple_files = true;
option java_package = "api.videoApi.service.v1";
import "api/videoApi/service/v1/base.proto";
import "google/api/annotations.proto";

service GroupService {
  // 创建群聊
  rpc CreateGroup(CreateGroupReq) returns (CreateGroupResp) {
    option (google.api.http) = {
      post: "/v1/group"
      body: "*"
    };
  };

  // 获取我创建的群聊
  rpc LoadMyGroup(LoadMyGroupReq) returns (LoadMyGroupResp) {
    option (google.api.http) = {
      post: "/v1/group/my"
      body:"*"
    };
  };

  // 检查群聊加群方式
  rpc CheckGroupAddMode(CheckGroupAddModeReq) returns (CheckGroupAddModeResp) {
    option (google.api.http) = {
      get: "/v1/group/{group_id}/add-mode"
    };
  };

  // 直接进群
  rpc EnterGroupDirectly(EnterGroupDirectlyReq) returns (EnterGroupDirectlyResp) {
    option (google.api.http) = {
      post: "/v1/group/{group_id}/enter"
      body: "*"
    };
  };

  // 申请加群
  rpc ApplyJoinGroup(ApplyJoinGroupReq) returns (ApplyJoinGroupResp) {
    option (google.api.http) = {
      post: "/v1/group/{group_id}/apply"
      body: "*"
    };
  };

  // 退群
  rpc LeaveGroup(LeaveGroupReq) returns (LeaveGroupResp) {
    option (google.api.http) = {
      delete: "/v1/group/{group_id}/leave"
    };
  };

  // 解散群聊
  rpc DismissGroup(DismissGroupReq) returns (DismissGroupResp) {
    option (google.api.http) = {
      delete: "/v1/group/{group_id}"
    };
  };

  // 获取群聊信息
  rpc GetGroupInfo(GetGroupInfoReq) returns (GetGroupInfoResp) {
    option (google.api.http) = {
      get: "/v1/group/{group_id}"
    };
  };

  // 获取我加入的群聊
  rpc ListMyJoinedGroups(ListMyJoinedGroupsReq) returns (ListMyJoinedGroupsResp) {
    option (google.api.http) = {
      post: "/v1/group/joined"
      body:"*"
    };
  };

  // 处理加群申请
  rpc HandleGroupApply(HandleGroupApplyReq) returns (HandleGroupApplyResp) {
    option (google.api.http) = {
      post: "/v1/group/apply/handle"
      body: "*"
    };
  }

  // 获取群成员列表
  rpc GetGroupMembers(GetGroupMembersReq) returns (GetGroupMembersResp) {
    option (google.api.http) = {
      get: "/v1/group/{group_id}/members"
    };
  }

}


// 群聊信息
message GroupInfo {
  string id = 1;
  string name = 2;
  string notice = 3;
  int32 member_cnt = 4;
  string owner_id = 5;
  int32 add_mode = 6;
  string avatar = 7;
  int32 status = 8;
  string created_at = 9;
  string updated_at = 10;
}

// 创建群聊请求
message CreateGroupReq {
  string name = 1;
  string notice = 2;
  int32 add_mode = 3;
  string avatar = 4;
}

message CreateGroupResp {
  string group_id = 1;
}

// 获取我创建的群聊请求
message LoadMyGroupReq {
  PageStatsReq page_stats = 1;
}

message LoadMyGroupResp {
  repeated GroupInfo groups = 1;
  PageStatsResp page_stats = 2;
}

// 检查群聊加群方式请求
message CheckGroupAddModeReq {
  string group_id = 1;
}

message CheckGroupAddModeResp {
  int32 add_mode = 1;
}

// 直接进群请求
message EnterGroupDirectlyReq {
  string group_id = 1;
}

message EnterGroupDirectlyResp {}

// 申请加群请求
message ApplyJoinGroupReq {
  string group_id = 1;
  string apply_reason = 2;
}

message ApplyJoinGroupResp {}

// 退群请求
message LeaveGroupReq {
  string group_id = 1;
}

message LeaveGroupResp {}

// 解散群聊请求
message DismissGroupReq {
  string group_id = 1;
}

message DismissGroupResp {}

// 获取群聊信息请求
message GetGroupInfoReq {
  string group_id = 1;
}

message GetGroupInfoResp {
  GroupInfo group = 1;
}

// 获取我加入的群聊请求
message ListMyJoinedGroupsReq {
  PageStatsReq page_stats = 1;
}

message ListMyJoinedGroupsResp {
  repeated GroupInfo groups = 1;
  PageStatsResp page_stats = 2;
}

 // 处理加群申请请求
 message HandleGroupApplyReq {
   string apply_id = 1;
   bool accept = 2;
   string reply_msg = 3;
 }

 message HandleGroupApplyResp {}

 // 获取群成员列表请求
 message GetGroupMembersReq {
   string group_id = 1;
 }

 message GetGroupMembersResp {
   repeated string member_ids = 1;
 }